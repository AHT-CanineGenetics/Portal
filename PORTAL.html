<!DOCTYPE html>
<html lang="en">
<head>
	<title>AHT DNA Testing - Remote swab testing portal</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- <link rel="icon" type="image/png" sizes="96x96" href=".includes/images/favicon-96x96.png"> -->
	<link rel="icon" type="image/png" sizes="96x96" href=".includes/images/favicon.ico">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" type="text/css" href=".includes/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href=".includes/css/bootstrap-datepicker.min.css">
	<link rel="stylesheet" type="text/css" href=".includes/css/datatables.min.css"/>
	<link rel="stylesheet" type="text/css" href=".includes/css/bootstrap-toggle.min.css">
	<link rel="stylesheet" type="text/css" href=".includes/css/bootstrap-dialog.min.css">
	<link rel="stylesheet" type="text/css" href=".includes/css/font-awesome.min.css">
	<style>
		.error, .required { border-color: #a94442; }
		.valid { border-color: #3c763d; }
		@media only screen and (max-width: 760px){
			img.top-logo { width: 77%; }
			div.swab_details_filter { display:none; }
			table.swab_details { display:none; }
		}
		@media only screen and (max-width: 550px){
			img.top-logo { width: 82%; }
			div.swab_details_filter { display:none; }
			table.swab_details { display:none; }
		}
	</style>
</head>
<body>
	<div class="container-fluid">
		<div class="row" style="text-align:center">
			<img src=".includes/images/aht-logo.png" style="float:left" class="hidden-sm hidden-xs" />
			<img src=".includes/images/aht-logo-sml.png" style="float:left" class="visible-sm visible-xs" />
			<div class="btn-group-vertical pull-right" role="group" style="margin-top:10px; margin-right:15px">
				<a href="Instructions.pdf" target="_blank" class="btn btn-default"><i class="fa fa-file-pdf-o text-danger" aria-hidden="true"></i>&nbsp;<span class="hidden-sm hidden-xs">View </span>Docs</a>
				<button type="button" class="btn btn-default" id="but_clearall"><i class="fa fa-trash-o" aria-hidden="true"></i>&nbsp;Clear<span class="hidden-sm hidden-xs"> ALL Data</span></button>
			</div>
			<h1 class="hidden-sm hidden-xs" style="line-height: 105px;margin: 0 463px 0 0;">Remote Swab Collection Portal</h1>
		</div>
		<div class="row visible-sm visible-xs" style="text-align:center">
			<div class="col-sm-12">
				<h1>Remote Swab Collection Portal</h1>
			</div>
		</div>
		<form class="form-horizontal" id="swab_details_form" method="post" action="test.html">
			<div class="row">
				<div class="col-sm-6">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">1. Sample Details</h3>
						</div>
						<div class="panel-body">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Next Swab</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" value="" name="swab-id" id="swab-id" readonly/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Report Format</label>
                                <div class="col-sm-3">
									<label class="radio-inline"><input type="radio" class="radiorequired" value="Email" name="format" checked="checked"/> Email</label>
									<label class="radio-inline"><input type="radio" class="radiorequired" value="Post" name="format"/> Post</label>
									<label class="radio-inline"><input type="radio" class="radiorequired" value="Fax" name="format"/> Fax</label>
                                </div>
                                
                                <label class="col-sm-2 control-label">Vet Verified?</label>
                                <div class="col-sm-1">
                                	<input type="checkbox" data-toggle="toggle" data-on="Yes" data-off="No" data-size="small" name="vet-verified" id="vet-verified" />
                                </div>
                              	<div class="col-sm-3" style="display:none" id="vet-select-div">
                              		<select id="vet-select" class="form-control" name="vet-select">
                              			<option value="0">Add another Vet...</option> 
                              		</select>
                              	</div>
                            </div>
                            <div class="form_group">
                            	<div class="col-sm-3 control-label">                            		
                                	<input type="checkbox" data-toggle="toggle" data-on="Yes" data-off="No" data-size="small" name="research" id="research" checked="checked" />
                                </div>
                            	<div class="col-sm-9">
                            		<label>The owner gives consent for the use of these samples for ongoing research into animal health and diseases at the Animal Health Trust.</label>
								</div>
                            </div>                            
                            
						</div>
					</div>
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">2. Dog Details</h3>
						</div>
						<div class="panel-body">
							<div class="form-group">
                              	<label class="col-sm-3 control-label">Breed</label>
                              	<div class="col-sm-9">
                              		<select id="breed-select" class="form-control required" name="breed">
                              			<option value="">Select Breed of your Dog...</option>
                              			<option value="Afghan Hound">Afghan Hound</option><option value="Akita">Akita</option><option value="American Staffordshire Terrier">American Staffordshire Terrier</option><option value="Australian Cattle Dog">Australian Cattle Dog</option><option value="Australian Shepherd">Australian Shepherd</option><option value="Basset Hound">Basset Hound</option><option value="Beagle">Beagle</option><option value="Bearded Collie">Bearded Collie</option><option value="Bedlington Terrier">Bedlington Terrier</option><option value="Belgian Shepherd Dog">Belgian Shepherd Dog</option><option value="Boerboel">Boerboel</option><option value="Border Collie">Border Collie</option><option value="Border Terrier">Border Terrier</option><option value="Borzoi">Borzoi</option><option value="Boston Terrier">Boston Terrier</option><option value="Briard">Briard</option><option value="Bull Mastiff">Bull Mastiff</option><option value="Bull Terrier">Bull Terrier</option><option value="Bulldog">Bulldog</option><option value="Cavalier King Charles Spaniel">Cavalier King Charles Spaniel</option><option value="Chihuahua">Chihuahua</option><option value="Chinese Crested">Chinese Crested</option><option value="Chow Chow">Chow Chow</option><option value="Crossbreed">Crossbreed</option><option value="Dachshund (Miniature Long Haired)">Dachshund (Miniature Long Haired)</option><option value="Dachshund (Miniature Smooth Haired)">Dachshund (Miniature Smooth Haired)</option><option value="Dachshund (Miniature Wire Haired)">Dachshund (Miniature Wire Haired)</option><option value="Dachshund (Standard Wire Haired)">Dachshund (Standard Wire Haired)</option><option value="Dalmatian">Dalmatian</option><option value="Dobermann">Dobermann</option><option value="Dogue De Bordeaux">Dogue De Bordeaux</option><option value="English Mastiff">English Mastiff</option><option value="English Shepherd">English Shepherd</option><option value="Finnish Lapphund">Finnish Lapphund</option><option value="Fox Terrier (Wire)">Fox Terrier (Wire)</option><option value="French Bulldog">French Bulldog</option><option value="German Shepherd Dog">German Shepherd Dog</option><option value="Giant Schnauzer">Giant Schnauzer</option><option value="Golden Retriever">Golden Retriever</option><option value="Gordon Setter">Gordon Setter</option><option value="Grand Basset Griffon Vendéen">Grand Basset Griffon Vendéen</option><option value="Hungarian Vizsla (Smooth-Haired)">Hungarian Vizsla (Smooth-Haired)</option><option value="Hungarian Wire Haired Vizsla">Hungarian Wire Haired Vizsla</option><option value="Irish Red &amp; White Setter">Irish Red &amp; White Setter</option><option value="Irish Setter">Irish Setter</option><option value="Italian Greyhound">Italian Greyhound</option><option value="Italian Spinone">Italian Spinone</option><option value="Jack Russell Terrier">Jack Russell Terrier</option><option value="Jagdterrier">Jagdterrier</option><option value="Keeshond">Keeshond</option><option value="Lancashire Heeler">Lancashire Heeler</option><option value="Large Münsterländer">Large Münsterländer</option><option value="Leonberger">Leonberger</option><option value="McNab Shepherd">McNab Shepherd</option><option value="Miniature American Shepherd">Miniature American Shepherd</option><option value="Miniature Bull Terrier">Miniature Bull Terrier</option><option value="Miniature Schnauzer">Miniature Schnauzer</option><option value="Nova Scotia Duck Tolling Retriever">Nova Scotia Duck Tolling Retriever</option><option value="Old English Sheepdog">Old English Sheepdog</option><option value="Parson Russell Terrier">Parson Russell Terrier</option><option value="Patterdale Terrier">Patterdale Terrier</option><option value="Petit Basset Griffon Vendéen">Petit Basset Griffon Vendéen</option><option value="Pomeranian">Pomeranian</option><option value="Pug">Pug</option><option value="Rat Terrier">Rat Terrier</option><option value="Retriever (Curly Coated)">Retriever (Curly Coated)</option><option value="Retriever (Labrador)">Retriever (Labrador)</option><option value="Rough Collie">Rough Collie</option><option value="Russian Black Terrier">Russian Black Terrier</option><option value="Saluki">Saluki</option><option value="Schipperke">Schipperke</option><option value="Scottish Deerhound">Scottish Deerhound</option><option value="Sealyham Terrier">Sealyham Terrier</option><option value="Shar Pei">Shar Pei</option><option value="Shetland Sheepdog">Shetland Sheepdog</option><option value="Shih Tzu">Shih Tzu</option><option value="South African Boerbeol">South African Boerbeol</option><option value="Spaniel (American Cocker)">Spaniel (American Cocker)</option><option value="Spaniel (Clumber)">Spaniel (Clumber)</option><option value="Spaniel (Cocker)">Spaniel (Cocker)</option><option value="Spaniel (English Springer)">Spaniel (English Springer)</option><option value="Spaniel (Sussex)">Spaniel (Sussex)</option><option value="Spaniel (Welsh Springer)">Spaniel (Welsh Springer)</option><option value="Spanish Water Dog">Spanish Water Dog</option><option value="St. Bernard">St. Bernard</option><option value="Stabyhoun">Stabyhoun</option><option value="Staffordshire Bull Terrier">Staffordshire Bull Terrier</option><option value="Swedish Lapphund">Swedish Lapphund</option><option value="Tenterfield Terrier">Tenterfield Terrier</option><option value="Tibetan Spaniel">Tibetan Spaniel</option><option value="Tibetan Terrier">Tibetan Terrier</option><option value="Toy Fox Terrier">Toy Fox Terrier</option><option value="Volpino Italiano">Volpino Italiano</option><option value="Weimaraner">Weimaraner</option><option value="Welsh Terrier">Welsh Terrier</option><option value="Whippet">Whippet</option><option value="Yorkshire Terrier">Yorkshire Terrier</option>
                              		</select>
                              	</div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Registered Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" value="" name="registered-name" id="registered-name"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Registration Number</label>
                                <div class="col-sm-3">
                                    <input type="text" class="form-control" value="" name="registration-number" id="registration-number"/>
                                </div>
								<label class="col-sm-3 control-label">Pet Name</label>
								<div class="col-sm-3">
									<input type="text" class="form-control required" value="" name="pet-name" id="pet-name"/>
								</div>
                            </div>
                            <div class="form-group">
								<label class="col-sm-3 control-label">Birth Date</label>
								<div class="col-sm-3">
									<input type="text" value="" name="birth-date" id="birth-date" class="form-control datepicker-me required num" autocomplete="off" placeholder="dd/mm/yyyy" />
								</div>
                                <label class="col-sm-3 control-label">Sex</label>
                                <div class="col-sm-3">
                                	<div class="radioerror"></div>
									<label class="radio-inline">
										<input type="radio" class="radiorequired" value="Male" name="sex" checked="checked"/> Male
									</label>
									<label class="radio-inline">
										<input type="radio" class="radiorequired" value="Female" name="sex"/> Female
									</label>
                                </div>
                            </div>
                            <div class="form-group">
								<label class="col-sm-3 control-label">Colour</label>
								<div class="col-sm-9">
									<input type="text" class="form-control" value="" name="colour" id="colour"/>
								</div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Microchip</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" value="" name="microchip" id="microchip"/>
                                </div>
                            </div>
						</div>
					</div>
				</div>
				<div class="col-sm-6">
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">3. Owner Details</h3>
						</div>
						<div class="panel-body">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Owner's Name</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control required" value="" name="owner-name" id="owner-name"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Address</label>
                                <div class="col-sm-9">
                                    <input type="text" class="form-control" value="" name="owner-address" id="owner-address"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Postcode</label>
                                <div class="col-sm-3">
                                    <input type="text" class="form-control" value="" name="owner-postcode" id="owner-postcode"/>
                                </div>
                                <label class="col-sm-2 control-label">Email</label>
                                <div class="col-sm-4">
                            		<input type="email" class="form-control required" value="" name="owner-email" id="owner-email"/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Phone</label>
                                <div class="col-sm-3">
                                    <input type="phone" class="form-control" value="" name="owner-phone" id="owner-phone"/>
                                </div>
                                <label class="col-sm-2 control-label">Fax</label>
                                <div class="col-sm-4">
                                    <input type="phone" class="form-control" value="" name="owner-fax" id="owner-fax"/>
                                </div>
                            </div>
						</div>
					</div>
					<div class="panel panel-primary">
						<div class="panel-heading">
							<h3 class="panel-title">4. Tests Available</h3>
						</div>
						<div class="panel-body" id="available_tests">
							<p>Please first select your dog breed from the dropdown list in DOG DETAILS section to view the list of tests available.</p>
						</div>
					</div>
					
					<input type="submit" value="Record Details" id="form_submission_but" name="submit" class="btn btn-primary pull-right" disabled="disabled"/>
			
				</div>
			</div>			
		</form>
		<div class="row"><div class="col-sm-12"><hr /></div></div>
		<div class="row">
			<div class="col-sm-12" style="font-size:0.8em">
				<table id="swab_details" class="table table-bordered table-hover display" width="100%">
				        <thead>
							<tr>
								<th>Swab#</th>
								<th>Test</th>
								<th>Vet Verified?</th>
								<th>Report?</th>
								<th>Registered Name</th>
								<th>Pet Name</th>
								<th>Reg No.</th>
								<th>Microchip</th>
								<th>DOB</th>
								<th>Breed</th>
								<th>Colour</th>
								<th>Sex</th>
								<th>Owner</th>
								<th>Email</th>
								<th>Phone</th>
								<th>Fax</th>
								<th>Address</th>
								<th>Postcode</th>
								<th>Vet</th>
								<th>Vet Email</th>
								<th>Vet Phone</th>
								<th>Vet Fax</th>
								<th>Vet Address</th>
								<th>Vet Postcode</th>
								<th>Research?</th>
							</tr>
						</thead>
				</table>
			</div>
		</div>
	</div>
	<footer>
	</footer>
	
	<!-- Vet Details Modal -->
	<div class="modal" id="vetModal" tabindex="-1" role="dialog" aria-labelledby="vetModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="vetModalLabel">Vet Details</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" id="vet_details_form">
						<div class="form-group">
							<label class="col-sm-3 control-label">Vet's Name</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" value="" name="vet-name" id="vet-name"/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">Address</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" value="" name="vet-address" id="vet-address"/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">City</label>
							<div class="col-sm-4">
								<input type="text" class="form-control" value="" name="vet-city" id="vet-city"/>
							</div>
							<label class="col-sm-2 control-label">Postcode</label>
							<div class="col-sm-3">
								<input type="text" class="form-control" value="" name="vet-postcode" id="vet-postcode"/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">Email</label>
							<div class="col-sm-9">
								<input type="email" class="form-control required" value="" name="vet-email" id="vet-email"/>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">Phone</label>
							<div class="col-sm-4">
								<input type="phone" class="form-control" value="" name="vet-phone" id="vet-phone"/>
							</div>
							<label class="col-sm-2 control-label">Fax</label>
							<div class="col-sm-3">
								<input type="phone" class="form-control" value="" name="vet-fax" id="vet-fax"/>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal" id="but-cancel-vet">Cancel</button>
					<button type="button" class="btn btn-primary" data-dismiss="modal" id="but-add-vet">Add Vet</button>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Latest compiled and minified JavaScript -->
	<script type="text/javascript" src=".includes/js/jquery-2.2.3.min.js"></script>
	<script type="text/javascript" src=".includes/js/datatables.min.js"></script>
	<script type="text/javascript" src=".includes/js/bootbox.min.js"></script>
	<script type="text/javascript" src=".includes/js/bootstrap.min.js"></script>
	<script type="text/javascript" src=".includes/js/bootstrap-toggle.min.js"></script>
	<script type="text/javascript" src=".includes/js/bootstrap-dialog.min.js"></script>
	<script type="text/javascript" src=".includes/js/bootstrap-datepicker.min.js"></script>
	<script type="text/javascript" src=".includes/js/jquery.validate.min.js"></script>
	<script type="text/javascript" src=".includes/js/data.js"></script>
	<script type="text/javascript" src=".includes/js/functions.js"></script>
	<script>
	$(document).ready(function() {
			
			var dataSet;
			try{ dataSet = JSON.parse(localStorage.getItem('dataSet')) || []; }
			catch (err) { dataSet = []; }
			
			var vetDetails;
			try{ vetDetails = JSON.parse(localStorage.getItem('vetDetails')) || []; }
			catch (err) { vetDetails = []; }
			for (var i = 0; i < vetDetails.length; i++) {
				var vet = vetDetails[i];
				$('#vet-select').append($('<option>', {value:vet.id, text:vet.name}));
			}
			
			if (localStorage.getItem("nextSwab") === null) {
				localStorage.setItem('nextSwab', startingSwab);
			}
			var swabID = localStorage.getItem('nextSwab');
			$('#swab-id').val(swabPrefix + swabID);
					
			$("#swab_details_form").validate({
//					rules: {
//						'breed_tests': {
//							required: true
//						}
//					},
					errorPlacement: function(error, element){
						/* Need to add this function to remove the error default placement */
					}
			});
			$('input[class="radiorequired"]').rules("add", "required");
			$('#swab_details_form input').on('keyup blur', function () { // fires on every keyup & blur
					if ($('#swab_details_form').valid()) {                   // checks form for validity
						$('#form_submission_but').prop('disabled', false);        // enables button
					} else {
						$('#form_submission_but').prop('disabled', 'disabled');   // disables button
					}
			});
			
			$('.datepicker-me').datepicker({
					format: 'dd/mm/yyyy'
			});
			
			$('input[name="format"]').change(function() {
					if($(this).val() == 'Email') {
						$("#vet-email").addClass("required");
						$("#owner-email").addClass("required");
						$('#vet-address').removeClass("error required");
						$('#owner-address').removeClass("error required");
						$('#vet-postcode').removeClass("error required");
						$('#owner-postcode').removeClass("error required");
						$('#vet-fax').removeClass("error required");
						$('#owner-fax').removeClass("error required");
					}
					else if ($(this).val() == 'Fax') {
						$('#vet-fax').addClass("required");
						$('#owner-fax').addClass("required");
						$("#vet-email").removeClass("error required");
						$("#owner-email").removeClass("error required");
						$('#vet-address').removeClass("error required");
						$('#owner-address').removeClass("error required");	
						$('#vet-postcode').removeClass("error required");
						$('#owner-postcode').removeClass("error required");					
					}
					else if ($(this).val() == 'Post') {
						$('#vet-address').addClass("required");
						$('#owner-address').addClass("required");
						$('#vet-postcode').addClass("required");
						$('#owner-postcode').addClass("required");
						$("#vet-email").removeClass("error required");
						$("#owner-email").removeClass("error required");
						$('#vet-fax').removeClass("error required");
						$('#owner-fax').removeClass("error required");						
					}
			});
			
			$('#vet-select').change(function(e) {
					if ($(this).val() == 0){
						showVetModal();
					}
			});
			
			$('#vet-verified').change(function() {
					if ( $(this).prop('checked')){
						if (vetDetails.length == 0){
							showVetModal();
						}else{
							$('#vet-select option:last').prop('selected', true);
						}
						$('#vet-select-div').show();
					}
					else{
						$('#vet-select-div').hide();
					}						
			});
			
			$('#but-add-vet').click(function(){
					addVetDetails();
			});
			
			var table = $('#swab_details').DataTable( {
					"data" : [],
					"order": [[ 1, "desc" ]],
					"columns": [
						{ 
							title: "Returned?",
							render: function ( data, type, row ) {
								if ( type === 'display' ) {
									var cell_contents = '';
									if (data == 1){
										cell_contents = '<i id="'+row[1]+'" class="fa fa-check-square-o fa-lg text-success" aria-hidden="true"></i>';
										//return '<input type="checkbox" class="checkbox_check" checked="checked" disabled>';
									}
									else{
										cell_contents = '<i id="'+row[1]+'" style="cursor:pointer" class="swab_ret fa fa-square-o fa-lg text-danger" aria-hidden="true"></i>';
										//return '<input type="checkbox" class="checkbox_check">';
									}
									cell_contents += '<span id="span_'+row[1]+'"  style="display:none;">'+data+'</span>';
									return cell_contents;
								}
								return data;
							},
							className: "text-center"
						},
						{ title: "Swab#" },
						{ title: "Test" },
						{ title: "Vet Verified?" },
						{ title: "Report?" },
						{ title: "Registered Name" },
						{ title: "Pet Name" },
						{ title: "Reg No." },
						{ title: "Microchip" },
						{ title: "DOB" },
						{ title: "Breed" },
						{ title: "Colour" },
						{ title: "Sex" },
						{ title: "Owner" },
						{ title: "Email" },
						{ title: "Phone" },
						{ title: "Fax" },
						{ title: "Address" },
						{ title: "Postcode" },
						{ title: "Vet" },
						{ title: "Vet Email" },
						{ title: "Vet Phone" },
						{ title: "Vet Fax" },
						{ title: "Vet Address" },
						{ title: "Vet Postcode" },
						{ title: "Research?" }
					],
					columnDefs: [
						{ targets: 0, width: "50px", searchable: false },
						{ targets: [19], visible: false, searchable: true },
						{ targets: [9,11,12,14,16,17,18,20,21,22,23,24,25], visible: false, searchable: false }
					],
					dom: 
		"<'row'<'col-sm-6'B><'col-sm-6'f>>" +
		"<'row'<'col-sm-12'tr>>" +
		"<'row'<'col-sm-5'i><'col-sm-7'p>>",
					buttons: [
						{
							extend: 'csv',
							text: "Export",
							fieldSeparator: "\t",
							fieldBoundary: ""
						}
					],
				} );
			for (var i = 0; i < dataSet.length; i++) {
				table.row.add(dataSet[i]).draw();
			}
			
			$('#breed-select').change(function(event){
					selectedBreed = $('#breed-select option:selected').val()
					if (selectedBreed !== ""){
						var html = '';
						var testAll = breedTests['all'];
						for (var key in testAll) {
							html += '<div class="checkbox"><label><input type="checkbox" name="breed_tests" value="'+key+'">'+testAll[key]+'</label></div>';
						}
						var testList = breedTests[selectedBreed];
						if (testList && Object.keys(testList).length > 0){
							for (var key in testList) {
								html += '<div class="checkbox"><label><input type="checkbox" name="breed_tests" value="'+key+'">'+testList[key]+'</label></div>';
							}
						}
						$('#available_tests').html(html);
					}
					else{
						$('#available_tests').html('<p>Please first select your dog breed from the dropdown list in DOG DETAILS section to view the list of tests available.</p>');
					}
			});
			
			$("#swab_details").on('click', '.swab_ret', function () {
			//$(".swab_ret").click(function(event){
					var id = $(this).attr('id');
					if ($(this).hasClass("swab_ret")){
						$(this).css('cursor', 'default');
						$(this).toggleClass("fa-square-o fa-check-square-o");
						$(this).toggleClass("text-danger text-success");
						$(this).removeClass("swab_ret");
						$("span#span_"+id).html( "1" );
						var data = table.row( $(this).parents('tr') ).data();
						data[0] = 1;
						table.row( $(this).parents('tr') ).data( data ).draw();
						dataSetLocal = JSON.parse(localStorage.getItem('dataSet'));
						for (var i = 0; i < dataSetLocal.length; i++) {
							if (dataSetLocal[i][1] === id){
								dataSetLocal[i][0] = 1;
							}
						}
						localStorage.setItem('dataSet', JSON.stringify(dataSetLocal));
					}
			});
			
			$("#but_clearall").click(function(event){
				bootbox.confirm({
						message: "Are you sure you wish to delete ALL saved data? This action cannot be undone.",
						buttons: {
							confirm: {
								label: 'Yes',
								className: 'btn-success'
							},
							cancel: {
								label: 'No',
								className: 'btn-danger'
							}
						},
						callback: function (result) {
							if (result){
								localStorage.clear();
								location.reload();
							}
						}
				});
			});
			
			
			
			$('#swab_details_form').submit(function(event) {
					event.preventDefault();
					if($('input:checkbox[name="breed_tests"]:checked').length === 0){
						alert("You need to select one or more tests for your dog.");
						return false;
					}
					
					var vetVerified = 'No';
					if($('input:checkbox[name="vet-verified"]:checked').val() === 'on'){
						vetDetails = JSON.parse(localStorage.getItem('vetDetails'));
						for (var i = 0; i < vetDetails.length; i++) {
							if (Number(vetDetails[i].id) === Number($('#vet-select option:selected').val())){
								vet = vetDetails[i];
								vetVerified = vet.name;
								$('#vet-name').val(vet.name);
								$('#vet-phone').val(vet.phone);
								$('#vet-fax').val(vet.fax);
								$('#vet-email').val(vet.email);
								$('#vet-address').val(vet.address+", "+vet.city);
								$('#vet-postcode').val(vet.postcode);
								break;
							}
						}
					}
					
					var research = 'Yes';
					if($('input:checkbox[name="research"]:checked').val() === 'off'){
						research = 'No';
					}
					
					var testList = [];
					var swabs = [];
					$('input:checkbox[name="breed_tests"]:checked').each(function() {
							testList.push($(this).val());
							swabs.push(swabPrefix + swabID);
							swabID = Number(swabID) + 1;
					});
				//	var formData = $('#swab_details_form').serialize();
				//	var regName = $('#registered-name').val();
					//breed=118&registered-name=Dekdays+Lexey+of+Tottlefields&registration-number=&pet-name=&birth-date=&colour=&microchip=
					for (var i=0; i<testList.length; i++){
						var data = [
								0,
								swabs[i],
								testList[i],
								vetVerified,
								$('input[name=format]:checked').val(),
								$('#registered-name').val(),
								$('#pet-name').val(),
								$('#registration-number').val(),
								$('#microchip').val(),
								$('#birth-date').val(),
								$('#breed-select option:selected').text(),
								$('#colour').val(),
								$('input[name=sex]:checked').val(),
								$('#owner-name').val(),
								$('#owner-email').val(),
								$('#owner-phone').val(),
								$('#owner-fax').val(),
								$('#owner-address').val(),
								$('#owner-postcode').val(),
								$('#vet-name').val(),
								$('#vet-phone').val(),
								$('#vet-fax').val(),
								$('#vet-email').val(),
								$('#vet-address').val(),
								$('#vet-postcode').val(),
								research
						];
						table.row.add(data).draw();
						dataSet.push(data);
					}
					localStorage.setItem('dataSet', JSON.stringify(dataSet));
					localStorage.setItem('nextSwab', (Number(swabID)));
					
					$('.valid').removeClass('valid');
					$('#breed-select').addClass('valid');
					
					$('#swab-id').val(swabPrefix + localStorage.getItem('nextSwab'));
					$("[name=format]").val(["Email"]);
					$('#registered-name').val("");
					$('#pet-name').val("");
					$('#registration-number').val("");
					$('#microchip').val("");
					$('#birth-date').val("");
					$('#breed').val("");
					$('#colour').val("");
					$("[name=sex]").val(["Male"]);
					$('#owner-name').val("");
					$('#owner-phone').val("");
					$('#owner-fax').val("");
					$('#owner-email').val("");
					$('#owner-address').val("");
					$('#owner-postcode').val("");
					$('input:checkbox[name="breed_tests"]:checked').prop("checked", false);
					$('#vet-name').val("");
					$('#vet-phone').val("");
					$('#vet-fax').val("");
					$('#vet-email').val("");
					$('#vet-address').val("");
					$('#vet-city').val("");
					$('#vet-postcode').val("");
					
					$('.datepicker-me').datepicker('setDate', null);
					
					
					if (testList.length > 1){
						var msg = ''
						for (var i=0; i<testList.length; i++){
							msg += '<span style="padding-left:25px;"><strong>'+swabs[i]+"</strong> - "+testList[i]+"</span><br />";
						}
						bootbox.alert({
								message: "<p>You have requested multiple tests for dog.</p><p>Please use the following swab IDs and sticker:-<br />"+msg+"</p>"
						});
					}
			});
	} );
	</script>
		
</body>
</html>